var mysql=require('mysql');

function connectServer(){

    var client=mysql.createConnection({
        host:'192.168.0.254',
        user:'tataufo',
        password:'Inno3pku',
        database:'test_gc1'
    })

    return client;
}


function  getUser(client,username,callback){
    //client为一个mysql连接对象
    client.query('select password from tb_user where username="'+username+'"',function(err,results,fields){
        if(err) throw err;

        callback(results);
    });
}

function insertUser(client , username , password,callback){
    console.log( username + password);
    client.query('insert into tb_user (username,password)values (?,?)', [username, password], function(err,result){
        if( err ){
            console.log( "error:" + err.message);
            return err;
        }
          callback(err);
    });
}

function  getDeviceList(client, county_id, callback){
    //client为一个mysql连接对象
    client.query('select device_id,device_pos,device_name,V_level,pos_x,pos_y from tb_device where county_id='+county_id ,function(err,results,fields){
       if( err ){
            console.log( "error:" + err.message);
            return err;
        }
       console.log( "results:" + results);
        callback(results);
    });
}

function  getModuleList(client, device_id, callback){
    //client为一个mysql连接对象
    client.query('select module_id,module_name,module_type,module_pos,producer,DATE_FORMAT(running_date,"%Y-%m-%d") as running_date,'
        + 'DATE_FORMAT(verify_date,"%Y-%m-%d") as verify_date,version,verify_code,net_address,bianbi,dingzhidanhao,tb_device.device_id ,tb_device.device_name '
        + 'from tb_module left join tb_device on tb_device.device_id=tb_module.device_id where tb_module.device_id='
        + device_id ,function(err,results,fields){
        if( err ){
            console.log( "error:" + err.message);
            return err;
        }
       console.log( "results:" + results);
        callback(results);
    });
}

function  getVillageList(client, county_id, callback){
    //client为一个mysql连接对象
    client.query('select village_id, village_name,V_level from tb_village where county_id='+county_id ,function(err,results,fields){
        if(err) throw err;

        callback(results);
    });
}

exports.connect = connectServer;
exports.getUser  = getUser;
exports.insertUser = insertUser;
exports.getDeviceList = getDeviceList;
exports.getModuleList = getModuleList;
exports.getVillageList = getVillageList;
